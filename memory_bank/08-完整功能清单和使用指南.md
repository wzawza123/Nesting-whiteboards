# 完整功能清单和使用指南

## 功能概览

嵌套白板项目是一个功能丰富的图形编辑器，支持多种节点类型、无限层级嵌套、丰富的交互操作和完整的文件管理功能。

## 1. 基础操作功能

### 节点创建
| 功能 | 操作方式 | 快捷键 | 说明 |
|------|----------|--------|------|
| 添加矩形节点 | 工具栏按钮 → 点击画布 | R | 创建可嵌套子图的矩形节点 |
| 添加文本节点 | 工具栏按钮 → 点击画布 | T | 创建纯文本节点 |
| 添加图片节点 | 复制图片 → 粘贴到画布 | Ctrl+V | 从剪贴板粘贴图片创建节点 |

### 节点搜索
| 功能 | 操作方式 | 快捷键 | 说明 |
|------|----------|--------|------|
| 打开搜索 | 按快捷键 | Ctrl+F | 打开节点搜索对话框 |
| 搜索节点 | 输入节点名称 | - | 实时搜索匹配的节点 |
| 选择结果 | 上下箭头键 | ↑/↓ | 在搜索结果中导航 |
| 跳转节点 | 回车键 | Enter | 跳转到选中的节点 |
| 关闭搜索 | 按快捷键 | Escape | 关闭搜索对话框 |

### 连接操作
| 功能 | 操作方式 | 快捷键 | 说明 |
|------|----------|--------|------|
| 创建连接线 | 工具栏箭头按钮 → 依次点击两个节点 | L | 在节点间创建有向连接线 |
| 删除连接 | 选中连接线 → 删除按钮 | Delete | 删除选中的连接线 |

### 基础交互
| 功能 | 操作方式 | 说明 |
|------|----------|------|
| 选择元素 | 点击节点或边 | 选中后显示高亮效果 |
| 移动节点 | 拖拽节点 | 实时移动节点位置 |
| 画布缩放 | 鼠标滚轮 | 缩放整个画布视图 |
| 画布拖拽 | 拖拽空白区域 | 移动画布视图 |
| 删除元素 | 选中后点击删除按钮 | Delete | 删除选中的节点或边 |

## 2. 文本编辑功能

### 编辑方式
| 方式 | 适用节点 | 操作 | 说明 |
|------|----------|------|------|
| 双击编辑 | 文本节点 | 双击节点 | 直接进入编辑模式 |
| 右键编辑 | 矩形/文本节点 | 右键 → 编辑文本 | 通过菜单进入编辑 |
| 快捷键编辑 | 任意节点 | 选中后按Enter | 快速进入编辑模式 |

### 文本样式调整
| 功能 | 操作方式 | 选项 |
|------|----------|------|
| 字体大小 | 右键菜单 → 字体大小 | 12px, 16px, 20px, 24px |
| 文本颜色 | 右键菜单 → 文本颜色 | 黑色, 蓝色, 绿色, 红色, 紫色, 橙色 |

### 编辑交互
- **确认编辑**: Enter键或点击外部区域
- **取消编辑**: Escape键
- **全选文本**: 进入编辑模式时自动全选
- **智能尺寸**: 输入框自动适配节点大小

## 3. 图片操作功能

### 图片节点操作
| 功能 | 操作方式 | 说明 |
|------|----------|------|
| 添加图片 | 复制图片 → Ctrl+V | 自动计算合适尺寸并创建节点 |
| 调整大小 | 拖拽四角控制点 | 保持宽高比，有最小尺寸限制 |
| 全屏预览 | 双击图片节点 | 打开全屏预览窗口 |

### 图片预览功能
| 功能 | 操作方式 | 说明 |
|------|----------|------|
| 缩放图片 | 鼠标滚轮 | 0.1x - 5x 缩放范围 |
| 拖拽移动 | 拖拽图片 | 在预览窗口内移动图片 |
| 关闭预览 | 点击背景或关闭按钮 | 退出全屏预览 |
| 缩放显示 | 左下角百分比显示 | 实时显示当前缩放比例 |

### 图片处理特性
- **自动尺寸**: 粘贴时自动调整到合适大小（最大250px）
- **保持比例**: 调整大小时保持原始宽高比
- **最小限制**: 最小尺寸30x30px
- **格式支持**: 支持所有浏览器可显示的图片格式

## 4. 子图嵌套功能

### 子图操作
| 功能 | 操作方式 | 说明 |
|------|----------|------|
| 进入子图 | 双击矩形节点 | 只有矩形节点支持子图功能 |
| 返回上级 | 右上角返回按钮 | 显示父节点名称 |
| 层级跳转 | 点击导航栏路径 | 直接跳转到任意层级 |

### 子图特性
- **无限嵌套**: 理论上支持无限层级的子图
- **独立编辑**: 每个子图都支持完整的编辑功能
- **状态保持**: 各层级的内容和状态完整保存
- **视觉提示**: 包含子图内容的节点显示双线边框

### 导航系统
| 元素 | 位置 | 功能 |
|------|------|------|
| 导航路径栏 | 底部居中 | 显示当前层级路径，支持点击跳转 |
| 返回按钮 | 右上角 | 返回上一层级，显示父节点名称 |
| 路径格式 | Root / Node1 / Node2 | 清晰显示层级关系 |

## 5. 文件管理功能

### 保存功能
| 方式 | 快捷键 | 说明 |
|------|--------|------|
| 保存到文件 | Ctrl+S | 支持现代浏览器的File System Access API |
| 下载保存 | 工具栏保存按钮 | 兼容模式，下载JSON文件 |

### 加载功能
| 方式 | 快捷键 | 说明 |
|------|--------|------|
| 打开文件 | Ctrl+O | 加载之前保存的JSON文件 |
| 拖拽加载 | 工具栏加载按钮 | 通过文件选择器加载 |

### 保存特性
- **完整数据**: 保存所有层级的完整子图数据
- **状态跟踪**: 实时显示保存状态和文件名
- **自动检测**: 监听所有修改操作，自动更新保存状态
- **错误处理**: 加载失败时显示友好的错误提示

### 状态指示
| 状态 | 显示 | 位置 | 颜色 |
|------|------|------|------|
| 已保存 | ✓ 已保存到: filename | 右下角 | 绿色 |
| 未保存 | ● filename - 未保存 | 右下角 | 橙色 |
| 新文档 | ● 新文档 - 未保存 | 右下角 | 橙色 |

## 6. 快捷键支持

### 工具操作快捷键
| 快捷键 | 功能 | 说明 |
|--------|------|------|
| R | 添加矩形 | 切换到矩形添加模式 |
| T | 添加文本 | 切换到文本添加模式 |
| L | 添加连线 | 切换到连线添加模式 |
| Delete | 删除选中 | 删除当前选中的元素 |
| Enter | 编辑文本 | 编辑选中节点的文本 |
| Escape | 取消操作 | 取消当前工具模式或操作 |

### 文件操作快捷键
| 快捷键 | 功能 | 说明 |
|--------|------|------|
| Ctrl+S | 保存 | 保存图形数据到文件 |
| Ctrl+O | 打开 | 加载图形数据文件 |
| Ctrl+V | 粘贴图片 | 从剪贴板粘贴图片 |

### 视图操作快捷键
| 快捷键 | 功能 | 说明 |
|--------|------|------|
| 空格 | 自动适配视图 | 自动调整画布显示所有内容 |
| 鼠标滚轮 | 缩放画布 | 缩放整个画布视图 |

## 7. 高级功能

### 自动适配视图
- **触发方式**: 空格键
- **适配逻辑**: 自动计算所有节点的边界，调整视图显示全部内容
- **缩放限制**: 最大1.5倍，最小0.2倍
- **边距设置**: 上下100px，左右150px的边距

### 智能交互
- **模式切换**: 工具按钮支持切换模式，再次点击取消
- **自动编辑**: 创建节点后自动进入编辑模式
- **状态同步**: 工具栏按钮状态与当前模式实时同步
- **冲突处理**: 切换模式时自动清理相关状态

### 性能优化
- **事件委托**: 使用事件委托减少内存占用
- **状态缓存**: 缓存常用状态避免重复计算
- **按需渲染**: 只在必要时重新渲染图形
- **内存管理**: 及时清理不需要的DOM元素和事件监听

## 8. 使用技巧

### 节点编辑技巧
1. **快速编辑**: 选中节点后直接按Enter键进入编辑
2. **批量操作**: 使用右键菜单可以快速调整文本样式
3. **复制粘贴**: 复制图片到剪贴板后直接Ctrl+V添加到画布

### 子图管理技巧
1. **层级规划**: 合理规划子图层级，避免过深的嵌套
2. **命名规范**: 给节点起有意义的名称，便于导航识别
3. **内容组织**: 相关内容放在同一个子图中，保持逻辑清晰

### 文件管理技巧
1. **定期保存**: 使用Ctrl+S快捷键定期保存工作
2. **备份管理**: 重要内容建议保存多个版本备份
3. **文件命名**: 使用有意义的文件名，便于后续查找

### 视图操作技巧
1. **视图适配**: 内容较多时使用空格键自动适配视图
2. **精确操作**: 放大画布进行精确的节点编辑和连线
3. **全局查看**: 缩小画布查看整体结构和布局

## 9. 节点搜索功能详解

### 搜索特性
- **实时搜索**: 输入时立即显示匹配结果，无需等待
- **跨层级搜索**: 可以搜索任意子图中的节点，不受当前层级限制
- **模糊匹配**: 支持部分匹配，输入节点名称的任意部分即可找到
- **路径显示**: 每个搜索结果都显示完整的层级路径，如 "Root / NodeA / NodeB"
- **智能导航**: 自动导航到目标节点所在的子图层级
- **节点居中**: 跳转后自动将目标节点居中显示

### 搜索界面
- **VSCode风格**: 熟悉的搜索界面和交互体验
- **键盘友好**: 完全支持键盘操作，无需鼠标
- **视觉反馈**: 选中结果高亮显示，清晰的路径信息
- **响应式设计**: 适配不同屏幕尺寸

### 使用技巧
1. **快速搜索**: 按Ctrl+F后直接输入节点名称，无需等待
2. **精确搜索**: 输入完整的节点名称可以获得更精确的结果
3. **层级导航**: 通过路径信息了解节点的层级位置
4. **批量查看**: 空搜索可以查看所有节点，了解整体结构
5. **快速跳转**: 使用上下箭头快速浏览搜索结果

### 搜索限制
- **基于标签**: 搜索基于节点的label属性，确保节点有合适的名称
- **矩形节点优先**: 只有矩形节点支持子图功能，搜索会优先显示
- **实时更新**: 新绘制的节点需要刷新搜索才能找到（已修复）

## 10. 常见问题解决

### 操作问题
- **节点无法选中**: 确保点击的是节点本体，不是空白区域
- **连线创建失败**: 确保先点击连线工具，再依次点击两个节点
- **图片无法粘贴**: 确保剪贴板中有图片数据，不是图片文件

### 性能问题
- **画布卡顿**: 节点过多时适当缩小画布或分层管理
- **内存占用**: 定期刷新页面释放内存
- **渲染慢**: 避免频繁的视图切换操作

### 文件问题
- **保存失败**: 检查浏览器是否支持File System Access API
- **加载出错**: 确保JSON文件格式正确，没有被外部编辑破坏
- **数据丢失**: 建议定期备份重要数据

## 10. 浏览器兼容性

### 推荐浏览器
- **Chrome 86+**: 完整支持所有功能
- **Edge 86+**: 完整支持所有功能
- **Firefox 82+**: 基础功能支持（文件保存使用下载模式）
- **Safari 14+**: 基础功能支持

### 功能支持情况
| 功能 | Chrome/Edge | Firefox | Safari |
|------|-------------|---------|--------|
| 基础编辑 | ✅ | ✅ | ✅ |
| 子图嵌套 | ✅ | ✅ | ✅ |
| 图片预览 | ✅ | ✅ | ✅ |
| 节点搜索 | ✅ | ✅ | ✅ |
| File System Access API | ✅ | ❌ | ❌ |
| 文件下载保存 | ✅ | ✅ | ✅ |

### 兼容性说明
- **现代浏览器**优先使用File System Access API实现无缝文件保存
- **传统浏览器**自动回退到下载模式，功能不受影响
- **移动端浏览器**基础功能正常，但交互体验可能有差异


